{"version":3,"file":"pdf_analyzer.min.js","sources":["../src/pdf_analyzer.js"],"sourcesContent":["define([], function() {\n    return {\n        init: function() {\n            const getDraftId = () => document.getElementById('id_files')?.value;\n            const sesskey = M.cfg.sesskey; // Moodle disponibiliza isto globalmente\n            const filemanagerList = document.querySelector('.filemanager .fp-content');\n\n            if (!filemanagerList) {\n                alert('filemanager nÃ£o encontrado!');\n                return;\n            }\n\n            const fetchPdfInfo = (draftid) => {\n                fetch('/blocks/pdfaccessibility/ajax/preview.php', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                        'X-Requested-With': 'XMLHttpRequest'\n                    },\n                    body: JSON.stringify({ draftid, sesskey })\n                })\n                .then(res => res.json())\n                .then(data => {\n                    const div = document.getElementById('analyzer-result');\n                    if (!div) {return;}\n                    if (data.status !== 'ok' || !data.summary) {\n                        div.innerHTML = `<span style=\"color:red\">${data.message || 'Erro ao analisar PDF.'}</span>`;\n                        return;\n                    }\n\n                    // Tente obter o nome do PDF do local correto\n                    let filename = 'PDF';\n                    if (data.filename) {\n                        filename = data.filename;\n                    } else if (data.pdfs && data.pdfs[0] && data.pdfs[0].filename) {\n                        filename = data.pdfs[0].filename;\n                    }\n\n                    const summary = data.summary;\n                    const checks = [\n                            {\n                                label: 'Document Title Check',\n                                value: summary['Title'] !== 'No Title Found' ? 'Pass' : 'Fail',\n                                pass: summary['Title'] !== 'No Title Found',\n                                link: \"https://www.w3.org/TR/WCAG20-TECHS/pdf#PDF18\",\n                                linkText: \"How to fix?\",\n                            },\n                            {\n                                label: 'Language Consistency Check',\n                                value: summary['Languages match'] ? 'Pass' : 'Fail',\n                                pass: summary['Languages match'],\n                                link: \"https://www.w3.org/TR/WCAG20-TECHS/pdf#PDF16\",\n                                linkText: \"How to fix?\",\n                            },\n                            {\n                                label: 'OCR Application Check',\n                                value: summary['PDF only image'] === 'PDF with text' ? 'Pass' : 'Fail',\n                                pass: summary['PDF only image'] === 'PDF with text',\n                                link: \"https://www.w3.org/TR/WCAG20-TECHS/pdf#PDF7\",\n                                linkText: \"How to fix?\",\n                            },\n                            {\n                                label: 'Link Validity Check',\n                                value: summary['Links Valid'] ? 'Pass' : 'Fail',\n                                pass: summary['Links Valid'],\n                                link: \"https://www.w3.org/TR/WCAG20-TECHS/pdf#PDF11\",\n                                linkText: \"How to fix?\",\n                            },\n                            {\n                                label: 'Image Alt Text Check',\n                                value: summary['Figures with alt text'] ? 'Pass' : 'Fail',\n                                pass: summary['Figures with alt text'],\n                                link: \"https://www.w3.org/TR/WCAG20-TECHS/pdf#PDF1\",\n                                linkText: \"How to fix?\",\n                            },\n                            {\n                                label: 'List Tagging Check',\n                                value: summary['Lists marked as Lists'] ? 'Pass' : 'Fail',\n                                pass: summary['Lists marked as Lists'],\n                                link: \"https://www.w3.org/TR/WCAG20-TECHS/pdf#PDF21\",\n                                linkText: \"How to fix?\",\n                            },\n                            {\n                                label: 'Table Header Check',\n                                value: summary['Table With Headers'] ? 'Pass' : 'Fail',\n                                pass: summary['Table With Headers'],\n                                link: \"https://www.w3.org/TR/WCAG20-TECHS/pdf#PDF6\",\n                                linkText: \"How to fix?\",\n                            }\n                    ];\n\n                    const passed = checks.filter(c => c.pass).length;\n                    const failed = checks.length - passed;\n                    checks.sort((a, b) => (a.pass === b.pass) ? 0 : a.pass ? -1 : 1);\n\n\n                    let html = `\n        <div style=\"font-family:Arial,sans-serif;max-width:320px;\">\n            <div style=\"background: #f8f9fa; border-radius: 8px; padding: 15px; background-color: white; \n            border-radius: 8px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); color: black; margin-bottom: 10px;\">\n                <i class=\"fa fa-info-circle\" aria-hidden=\"true\"></i>\n                <bold style=\"font-size: 0.95rem; font-weight: bold; margin-bottom: 2px;\">${filename}</bold><br>\n                <div style=\"margin-top:10px\">\n                    <span style=\"color:#27ae60;font-weight:bold;\">${passed}</span>\n                    <span style=\"color:black;\">passed</span>\n                    <span style=\"color:#e74c3c;font-weight:bold;margin-left:10px;\">${failed}</span>\n                    <span style=\"color:black;\">failed</span>\n                    \n                </div>\n            </div>\n            <div>\n            <div style=\"background: #f8f9fa;\n                        border-radius: 8px;\n                        padding: 10px;\n                        background-color: white;\n                        border-radius: 8px;\n                        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n                        color: black;\n                        margin-bottom: 10px;\">\n                             \n                    <bold style=\"   font-size: 0.90rem;\n                                    font-weight: bold;\n                                    margin-bottom: 2px;\">Detailed Report</bold><br>\n                    ${checks.map((c, i) => `\n    <div style=\"display:flex;align-items:flex-start;margin-top:8px;margin-bottom:10px;\n        background:${c.pass ? '#eafaf1' : '#fff4f4'};\n        border-radius:6px;padding:6px 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);\">\n        <span style=\"font-size:1.2em;margin-right:8px;margin-top:2px;color:${c.pass ? '#27ae60' : '#e74c3c'};\">\n            ${c.pass\n                ? '<i style=\"color:green;\" class=\"fa fa-check\" aria-hidden=\"true\"></i>'\n                : '<i style=\"color:red;\" class=\"fa fa-times\" aria-hidden=\"true\"></i>'\n            }\n        </span>\n        <div style=\"flex:1;\">\n            <div style=\"display:flex;align-items:center;justify-content:space-between;\">\n                <div style=\"font-weight:bold; font-size: 0.925rem; color: #1e1e1e;\">${c.label}</div>\n                ${!c.pass ? `\n                    <button type=\"button\"\n                        aria-expanded=\"false\"\n                        aria-controls=\"fail-detail-${i}\"\n                        style=\"background:none;border:none;cursor:pointer;padding:0 6px;\"\n                        onclick=\"\n                            var d=document.getElementById('fail-detail-${i}');\n                            var a=this.querySelector('.arrow');\n                            var expanded=this.getAttribute('aria-expanded')==='true';\n                            d.style.display=expanded?'none':'block';\n                            this.setAttribute('aria-expanded',!expanded);\n                            a.style.transform=expanded?'rotate(0deg)':'rotate(90deg)';\n                        \">\n                        <span class=\"arrow\" style=\"display:inline-block;transition:transform 0.2s;\n                        vertical-align:middle;\">&#9662;</span>\n                    </button>\n                ` : ''}\n            </div>\n            <div style=\"font-size: 0.9rem; color: #282828; margin-left: 1%; margin-top: 1px;\">${c.value}</div>\n            ${!c.pass ? `\n            <div id=\"fail-detail-${i}\" style=\"display:none;margin-top:5px;font-size:0.85em;color:#a94442;\">\n                <a href=\"${c.link}\" target=\"_blank\" rel=\"noopener\">${c.linkText || c.link}</a>\n            </div>\n        ` : ''}\n        </div>\n    </div>\n`).join('')}\n                        </div>\n                       \n                    </div>\n                    </div>\n                    `;\n                    div.innerHTML = html;\n                });\n            };\n\n            const observer = new MutationObserver(() => {\n                const draftid = getDraftId();\n                const div = document.getElementById('analyzer-result');\n                if (div) {\n                    div.innerHTML = '<span style=\"color:#555;\">Analyzing PDF accessibility, please wait...</span>';\n                }\n                if (draftid) {\n                    fetchPdfInfo(draftid);\n                }\n            });\n\n            observer.observe(filemanagerList, {\n                childList: true,\n                subtree: true\n            });\n        }\n    };\n});"],"names":["define","init","sesskey","M","cfg","filemanagerList","document","querySelector","alert","MutationObserver","draftid","getElementById","_document$getElementB","value","div","innerHTML","fetch","method","headers","body","JSON","stringify","then","res","json","data","status","summary","message","filename","pdfs","checks","label","pass","link","linkText","passed","filter","c","length","failed","sort","a","b","html","map","i","join","fetchPdfInfo","observe","childList","subtree"],"mappings":"AAAAA,6CAAO,IAAI,iBACA,CACHC,KAAM,iBAEIC,QAAUC,EAAEC,IAAIF,QAChBG,gBAAkBC,SAASC,cAAc,gCAE1CF,4BACDG,MAAM,+BAoKO,IAAIC,kBAAiB,WAC5BC,sCA1KeJ,SAASK,eAAe,oDAAxBC,sBAAqCC,MAA3C,gCA2KTC,IAAMR,SAASK,eAAe,mBAChCG,MACAA,IAAIC,UAAY,gFAEhBL,SAtKcA,CAAAA,UAClBM,MAAM,4CAA6C,CAC/CC,OAAQ,OACRC,QAAS,gBACW,sCACI,kBAExBC,KAAMC,KAAKC,UAAU,CAAEX,QAAAA,QAASR,QAAAA,YAEnCoB,MAAKC,KAAOA,IAAIC,SAChBF,MAAKG,aACIX,IAAMR,SAASK,eAAe,uBAC/BG,cACe,OAAhBW,KAAKC,SAAoBD,KAAKE,oBAC9Bb,IAAIC,4CAAuCU,KAAKG,SAAW,wCAK3DC,SAAW,MACXJ,KAAKI,SACLA,SAAWJ,KAAKI,SACTJ,KAAKK,MAAQL,KAAKK,KAAK,IAAML,KAAKK,KAAK,GAAGD,WACjDA,SAAWJ,KAAKK,KAAK,GAAGD,gBAGtBF,QAAUF,KAAKE,QACfI,OAAS,CACP,CACIC,MAAO,uBACPnB,MAA4B,mBAArBc,QAAO,MAAiC,OAAS,OACxDM,KAA2B,mBAArBN,QAAO,MACbO,KAAM,+CACNC,SAAU,eAEd,CACIH,MAAO,6BACPnB,MAAOc,QAAQ,mBAAqB,OAAS,OAC7CM,KAAMN,QAAQ,mBACdO,KAAM,+CACNC,SAAU,eAEd,CACIH,MAAO,wBACPnB,MAAqC,kBAA9Bc,QAAQ,kBAAwC,OAAS,OAChEM,KAAoC,kBAA9BN,QAAQ,kBACdO,KAAM,8CACNC,SAAU,eAEd,CACIH,MAAO,sBACPnB,MAAOc,QAAQ,eAAiB,OAAS,OACzCM,KAAMN,QAAQ,eACdO,KAAM,+CACNC,SAAU,eAEd,CACIH,MAAO,uBACPnB,MAAOc,QAAQ,yBAA2B,OAAS,OACnDM,KAAMN,QAAQ,yBACdO,KAAM,8CACNC,SAAU,eAEd,CACIH,MAAO,qBACPnB,MAAOc,QAAQ,yBAA2B,OAAS,OACnDM,KAAMN,QAAQ,yBACdO,KAAM,+CACNC,SAAU,eAEd,CACIH,MAAO,qBACPnB,MAAOc,QAAQ,sBAAwB,OAAS,OAChDM,KAAMN,QAAQ,sBACdO,KAAM,8CACNC,SAAU,gBAIhBC,OAASL,OAAOM,QAAOC,GAAKA,EAAEL,OAAMM,OACpCC,OAAST,OAAOQ,OAASH,OAC/BL,OAAOU,MAAK,CAACC,EAAGC,IAAOD,EAAET,OAASU,EAAEV,KAAQ,EAAIS,EAAET,MAAQ,EAAI,QAG1DW,gdAKmEf,kJAEvBO,4KAEiBI,myBAkB/DT,OAAOc,KAAI,CAACP,EAAGQ,2HAEhBR,EAAEL,KAAO,UAAY,wLAEmCK,EAAEL,KAAO,UAAY,sCACpFK,EAAEL,KACE,sEACA,+SAKoEK,EAAEN,yCACrEM,EAAEL,KAgBD,4JAbiCa,sNAGoBA,+vBAYuBR,EAAEzB,qCACnFyB,EAAEL,KAIL,gDAHuBa,8GACRR,EAAEJ,iDAAwCI,EAAEH,UAAYG,EAAEJ,+EAKlFa,KAAK,+IAMYjC,IAAIC,UAAY6B,SAWhBI,CAAatC,YAIZuC,QAAQ5C,gBAAiB,CAC9B6C,WAAW,EACXC,SAAS"}