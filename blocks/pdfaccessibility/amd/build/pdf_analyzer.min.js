define("block_pdfaccessibility/pdf_analyzer",[],(function(){return{init:function(){const sesskey=M.cfg.sesskey,filemanagerList=document.querySelector(".filemanager .fp-content");if(!filemanagerList)return void alert("filemanager nÃ£o encontrado!");const fetchPdfInfo=draftid=>{const courseid=function(){var courseIdFromUrl=new URLSearchParams(window.location.search).get("id");if(courseIdFromUrl&&parseInt(courseIdFromUrl)>0)return parseInt(courseIdFromUrl);var bodyElement=document.body;if(bodyElement){var courseIdFromBody=bodyElement.getAttribute("data-courseid")||bodyElement.getAttribute("data-course-id");if(courseIdFromBody&&parseInt(courseIdFromBody)>0)return parseInt(courseIdFromBody)}if("undefined"!=typeof M&&M.cfg&&M.cfg.courseId&&parseInt(M.cfg.courseId)>0)return parseInt(M.cfg.courseId);var courseLink=document.querySelector('a[href*="course/view.php?id="]');if(courseLink){var match=courseLink.href.match(/[?&]id=(\d+)/);if(match&&parseInt(match[1])>0)return parseInt(match[1])}return null}();fetch("/blocks/pdfaccessibility/ajax/preview.php",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({draftid:draftid,sesskey:sesskey,courseid:courseid})}).then((res=>res.json())).then((data=>{const div=document.getElementById("analyzer-result");if(!div)return;if("ok"!==data.status||!data.summary)return void(div.innerHTML='<span style="color:red">'.concat(data.message||"Erro ao analisar PDF.","</span>"));let filename="PDF";data.filename?filename=data.filename:data.pdfs&&data.pdfs[0]&&data.pdfs[0].filename&&(filename=data.pdfs[0].filename);const summary=data.summary,testConfig=data.testConfig||[],checks=testConfig.map((config=>{const value=(testKey=config.key,!0===(testValue=summary[config.key])?"Pass":"PDF not tagged"===testValue?"PDF not tagged":"Non applicable"===testValue?"Non applicable":!1===testValue||"Title"===testKey&&"No Title Found"===testValue?"Fail":"Title"===testKey&&"No Title Found"!==testValue?"Pass":"Languages match"===testKey?testValue?"Pass":"Fail":"PDF only image"===testKey?"PDF with text"===testValue?"Pass":"Fail":testValue);var testKey,testValue;return{label:config.label,value:value,pass:"Pass"===value,raw:summary[config.key],link:config.link,linkText:"How to fix?"}})),passed=checks.filter((c=>c.pass)).length,nonApplicable=checks.filter((c=>"Non applicable"===c.value)).length,failed=(checks.filter((c=>"PDF not tagged"===c.value)).length,checks.length-passed-nonApplicable);checks.sort(((a,b)=>{const getPriority=check=>check.pass?1:"Fail"===check.value?2:"PDF not tagged"===check.value?3:"Non applicable"===check.value?4:5;return getPriority(a)-getPriority(b)}));let html='\n        <div style="font-family:Arial,sans-serif;max-width:320px;">\n            <div style="background: #f8f9fa; border-radius: 8px; padding: 15px; background-color: white; \n            border-radius: 8px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); color: black; margin-bottom: 10px;">\n                <i class="fas fa-universal-access" aria-hidden="true"></i>\n                <bold style="font-size: 0.95rem; font-weight: bold; margin-bottom: 2px;">'.concat(filename,'</bold><br>\n                <div style="margin-top:10px">\n                    <span style="color:#27ae60;font-weight:bold;">').concat(passed,'</span>\n                    <span style="color:black;">passed</span>\n                    <span style="color:#e74c3c;font-weight:bold;margin-left:10px;">').concat(failed,'</span>\n                    <span style="color:black;">failed</span>\n                    \n                </div>\n            </div>\n            <div>\n            <div style="background: #f8f9fa;\n                        border-radius: 8px;\n                        padding: 10px;\n                        background-color: white;\n                        border-radius: 8px;\n                        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n                        color: black;\n                        margin-bottom: 10px;">\n                             \n                    <bold style="   font-size: 0.90rem;\n                                    font-weight: bold;\n                                    margin-bottom: 2px;">Detailed Report</bold><br>\n                    ').concat(checks.map(((c,i)=>{let bg=c.pass?"#eafaf1":"#fff4f4",icon=c.pass?'<i style="color:green;" class="fa fa-check" aria-hidden="true"></i>':'<i style="color:red;" class="fa fa-times" aria-hidden="true"></i>',color=c.pass?"#27ae60":"#e74c3c",opacity=1,extra="";return"Non applicable"===c.value&&(bg="#f3f3f3",color="#000000ff",opacity=.6,icon='<i style="color:#000000;" class="fa fa-minus-circle" aria-hidden="true"></i>'),"PDF not tagged"===c.value&&(bg="#fffbe6",color="#e6b800",icon='<i style="color:#e6b800;" class="fa fa-exclamation-triangle" aria-hidden="true"></i>',extra="<div style=\"margin-top:6px;padding:6px 8px;background:#fff3cd;border-radius:5px;color:#856404;\n                            font-size:0.88em;font-weight:bold;\">\n                                <i class='fa fa-exclamation-circle' style='margin-right:4px;'></i> This PDF is not tagged. \n                                We are unable to check the accessibility of this topic..\n                            </div>"),'\n    <div style="display:flex;align-items:flex-start;margin-top:8px;margin-bottom:10px;\n        background:'.concat(bg,";\n        border-radius:6px;padding:6px 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);opacity:").concat(opacity,';">\n        <span style="font-size:1.2em;margin-right:8px;margin-top:2px;color:').concat(color,';">\n            ').concat(icon,'\n        </span>\n        <div style="flex:1;">\n            <div style="display:flex;align-items:center;justify-content:space-between;">\n                <div style="font-weight:bold; font-size: 0.925rem; color: #1e1e1e;">').concat(c.label,"</div>\n                ").concat(c.pass||"PDF not tagged"===c.value||"Non applicable"===c.value?"":'\n                    <button type="button"\n                        aria-expanded="false"\n                        aria-controls="fail-detail-'.concat(i,'"\n                        style="background:none;border:none;cursor:pointer;padding:0 6px;"\n                        onclick="\n                            var d=document.getElementById(\'fail-detail-').concat(i,"');\n                            var a=this.querySelector('.arrow');\n                            var expanded=this.getAttribute('aria-expanded')==='true';\n                            d.style.display=expanded?'none':'block';\n                            this.setAttribute('aria-expanded',!expanded);\n                            a.style.transform=expanded?'rotate(0deg)':'rotate(90deg)';\n                        \">\n                        <span class=\"arrow\" style=\"display:inline-block;transition:transform 0.2s;\n                        vertical-align:middle;\">&#9662;</span>\n                    </button>\n                "),'\n            </div>\n            <div style="font-size: 0.9rem; color: #282828; margin-left: 1%; margin-top: 1px;">').concat(c.value,"</div>\n            ").concat(c.pass||"PDF not tagged"===c.value||"Non applicable"===c.value?"":'\n            <div id="fail-detail-'.concat(i,'" style="display:none;margin-top:5px;font-size:0.85em;color:#a94442;">\n                <a href="').concat(c.link,'" target="_blank" rel="noopener">').concat(c.linkText||c.link,"</a>\n            </div>\n        "),"\n            ").concat(extra,"\n        </div>\n    </div>\n                        ")})).join(""),"\n                        </div>\n                       \n                    </div>\n                    </div>\n                    ");div.innerHTML=html}))};new MutationObserver((()=>{const draftid=null===(_document$getElementB=document.getElementById("id_files"))||void 0===_document$getElementB?void 0:_document$getElementB.value;var _document$getElementB;const div=document.getElementById("analyzer-result");div&&(div.innerHTML='<span style="color:#555;">Analyzing PDF accessibility, please wait...</span>'),draftid&&fetchPdfInfo(draftid)})).observe(filemanagerList,{childList:!0,subtree:!0})}}}));

//# sourceMappingURL=pdf_analyzer.min.js.map