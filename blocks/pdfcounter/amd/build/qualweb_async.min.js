define("block_pdfcounter/qualweb_async",["exports","core/ajax"],(function(_exports,_ajax){var obj;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_ajax=(obj=_ajax)&&obj.__esModule?obj:{default:obj};_exports.init=courseid=>{const qualwebDiv=document.getElementById("qualweb-result-async");function updateStatus(msg){let details=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";qualwebDiv.innerHTML='<div style="background:#e3f2fd; border-radius:8px; padding:10px; margin-bottom:10px;">'.concat(msg).concat(details,"</div>")}qualwebDiv&&function pollStatus(){_ajax.default.call([{methodname:"block_pdfcounter_qualweb_eval",args:{courseid:courseid,action:"status"}}])[0].then((data=>{if("completed"===data.status){let res="";if(data.result_json)try{const result=JSON.parse(data.result_json);res="<br>Score: ".concat(result.score,"<br>Errors: ").concat(result.failed,"<br>Warnings: ").concat(result.warnings),res+="<details style='margin-top:5px;'><summary style='cursor:pointer;'>Ver JSON bruto do QualWeb</summary><pre style='font-size:0.8em; max-height:200px; overflow:auto; background:#f4f4f4; border-radius:4px; padding:6px;'>".concat(result.raw,"</pre></details>")}catch(e){}updateStatus("✅ Avaliação QualWeb concluída.",res)}else"running"===data.status||"pending"===data.status?(updateStatus("⏳ Avaliação QualWeb em andamento..."),setTimeout(pollStatus,3e3)):"error"===data.status?updateStatus("❌ Erro na avaliação QualWeb. Tente novamente."):(updateStatus("⏳ Iniciando avaliação QualWeb..."),_ajax.default.call([{methodname:"block_pdfcounter_qualweb_eval",args:{courseid:courseid}}])[0].then((()=>setTimeout(pollStatus,3e3))))})).catch((()=>updateStatus("❌ Erro de comunicação com o servidor.")))}()}}));

//# sourceMappingURL=qualweb_async.min.js.map