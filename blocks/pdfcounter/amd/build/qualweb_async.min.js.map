{"version":3,"file":"qualweb_async.min.js","sources":["../src/qualweb_async.js"],"sourcesContent":["// qualweb_async.js - Handles async QualWeb evaluation via AJAX\r\nimport Ajax from 'core/ajax';\r\n\r\nexport const init = (courseid) => {\r\n    const qualwebDiv = document.getElementById('qualweb-result-async');\r\n    if (!qualwebDiv) return;\r\n\r\n    function updateStatus(msg, details = '') {\r\n        qualwebDiv.innerHTML = `<div style=\"background:#e3f2fd; border-radius:8px; padding:10px; margin-bottom:10px;\">${msg}${details}</div>`;\r\n    }\r\n\r\n    function pollStatus() {\r\n        Ajax.call([\r\n            {\r\n                methodname: 'block_pdfcounter_qualweb_eval',\r\n                args: { courseid: courseid, action: 'status', module_type: 'resource' }\r\n            }\r\n        ])[0].then(data => {\r\n            if (data.status === 'completed') {\r\n                let res = '';\r\n                if (data.result_json) {\r\n                    try {\r\n                        const result = JSON.parse(data.result_json);\r\n                        res = `<br>Score: ${result.score}<br>Errors: ${result.failed}<br>Warnings: ${result.warnings}`;\r\n                        res += `<details style='margin-top:5px;'><summary style='cursor:pointer;'>Ver JSON bruto do QualWeb</summary><pre style='font-size:0.8em; max-height:200px; overflow:auto; background:#f4f4f4; border-radius:4px; padding:6px;'>${result.raw}</pre></details>`;\r\n                    } catch(e) {}\r\n                }\r\n                updateStatus('✅ Avaliação QualWeb concluída.', res);\r\n            } else if (data.status === 'running' || data.status === 'pending') {\r\n                updateStatus('⏳ Avaliação QualWeb em andamento...');\r\n                setTimeout(pollStatus, 3000);\r\n            } else if (data.status === 'error') {\r\n                updateStatus('❌ Erro na avaliação QualWeb. Tente novamente.');\r\n            } else {\r\n                // Start evaluation\r\n                updateStatus('⏳ Iniciando avaliação QualWeb...');\r\n                Ajax.call([\r\n                    {\r\n                        methodname: 'block_pdfcounter_qualweb_eval',\r\n                        args: { courseid: courseid, module_type: 'resource' }\r\n                    }\r\n                ])[0].then(() => setTimeout(pollStatus, 3000));\r\n            }\r\n        }).catch(() => updateStatus('❌ Erro de comunicação com o servidor.'));\r\n    }\r\n\r\n    pollStatus();\r\n};\r\n"],"names":["courseid","qualwebDiv","document","getElementById","updateStatus","msg","details","innerHTML","pollStatus","call","methodname","args","action","module_type","then","data","status","res","result_json","result","JSON","parse","score","failed","warnings","raw","e","setTimeout","catch"],"mappings":"iPAGqBA,iBACXC,WAAaC,SAASC,eAAe,iCAGlCC,aAAaC,SAAKC,+DAAU,GACjCL,WAAWM,0GAAqGF,YAAMC,kBAHrHL,qBAMIO,2BACAC,KAAK,CACN,CACIC,WAAY,gCACZC,KAAM,CAAEX,SAAUA,SAAUY,OAAQ,SAAUC,YAAa,eAEhE,GAAGC,MAAKC,UACa,cAAhBA,KAAKC,OAAwB,KACzBC,IAAM,MACNF,KAAKG,sBAEKC,OAASC,KAAKC,MAAMN,KAAKG,aAC/BD,yBAAoBE,OAAOG,6BAAoBH,OAAOI,gCAAuBJ,OAAOK,UACpFP,uOAAkOE,OAAOM,wBAC3O,MAAMC,IAEZtB,aAAa,iCAAkCa,SACxB,YAAhBF,KAAKC,QAAwC,YAAhBD,KAAKC,QACzCZ,aAAa,uCACbuB,WAAWnB,WAAY,MACA,UAAhBO,KAAKC,OACZZ,aAAa,kDAGbA,aAAa,kDACRK,KAAK,CACN,CACIC,WAAY,gCACZC,KAAM,CAAEX,SAAUA,SAAUa,YAAa,eAE9C,GAAGC,MAAK,IAAMa,WAAWnB,WAAY,WAE7CoB,OAAM,IAAMxB,aAAa,2CAGhCI"}